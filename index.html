<!DOCTYPE html>
<html>
    <head>
        <title>Gestion de Mascotas</title>
        <!--Bootstrap para los estilos visuales-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    </head>
    <!--Se aplica el bootstrap a traves de clases para el diseno-->
    <body class="container mt-4">
        <!--Titulo-->
        <h2 class="mb-4">Gestion de Mascotas</h2>
        
        <!-- Inputs  -->
        <div class="row g-3 mb-3">
            <!-- Campo para ID (usado solo al editar o eliminar) -->
            <div class="col-md-3">
                <label for="id" class="form-label">ID (solo para editar/eliminar)</label>
                <input type="number" id="id" class="form-control">
            </div>
            <!-- Campo para el nombre de la mascota -->
            <div class="col-md-3">
                <label for="nombre" class="form-label">Nombre</label>
                <input type="text" id="nombre" class="form-control">
            </div>
            <!-- Campo para el tipo de mascota (ej: perro, gato) -->
            <div class="col-md-3">
                <label for="tipo" class="form-label">Tipo</label>
                <input type="text" id="tipo" class="form-control">
            </div>
            <!-- Campo para la edad de la mascota -->
            <div class="col-md-3">
                    <label for="edad" class="form-label">Edad</label>
                    <input type="number" id="edad" class="form-control">
            </div>
        </div>
        
        <!-- Botones para la operacion CRUD -->
        <div class="mb-4">
            <button class="btn btn-success me-2" onclick="guardarMascota()">Crear</button>
            <button class="btn btn-warning me-2" onclick="editarMascota()">Editar</button>
            <button class="btn btn-danger" onclick="eliminarMascota()">Eliminar</button>
            <button class="btn btn-danger" onclick="listarMascotas()">Listar</button>
        </div>
        
        <!-- Tabla para mostrar las mascotas registradas -->
        <h4>Mascotas Registradas</h4>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Tipo</th>
                        <th>Edad</th>
                    </tr>
                </thead>
                <tbody id="listarMascotas"></tbody>
            </table>
        
        <!-- Mensaje de respuesta del servidor -->
        <div id="respuesta" class="alert alert-info mt-3"></div>

    
    </body>
    

    <!--Scripts para conectar con sus respectivos php-->
    <script>
        //Funcion para guardar la mascota
        function guardarMascota() {
            let nombre = document.getElementById("nombre").value;
            let tipo = document.getElementById("tipo").value;
            let edad = document.getElementById("edad").value;

            // Preparo los datos en formato x-www-form-urlencode
            let params = "nombre=" + nombre + "&tipo=" + tipo + "&edad=" + edad;
            let xh = new XMLHttpRequest();
            // Creo y configuro el XMLHTTpRequest para enviar los datos a los php
            xh.open("POST", "../Mascotas/crear.php", true);
            xh.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
             //  ejecuto al recibir respuesta del servidor
            xh.onload = function() {
                document.getElementById("respuesta").innerText = xh.responseText;
            };
            // Se envian los datos
            xh.send(params);
        }
         
        // Función para editar una mascota existente
        function editarMascota() {
            
            let id = document.getElementById("id").value;
            let nombre = document.getElementById("nombre").value;
            let tipo = document.getElementById("tipo").value;
            let edad = document.getElementById("edad").value;
            
            let params = "id=" + id + "&nombre=" + nombre + "&tipo=" + tipo + "&edad=" + edad;
            let xh = new XMLHttpRequest();
            xh.open("POST", "../Mascotas/editar.php", true);
            xh.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            
            xh.onload = function() {
                document.getElementById("respuesta").innerText = xh.responseText;
            };
            
            xh.send(params);
        }
        // Función para eliminar una mascota por ID
        function eliminarMascota() {
            let id = document.getElementById("id").value;

            if (!id) {
                alert("Por favor, ingresa un ID válido para eliminar.");
                return; //Salgo de la función si no hay ID
            }

            
            let params = "id=" + id;
            let xh = new XMLHttpRequest();
            xh.open("POST", "../Mascotas/eliminar.php", true);
            xh.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            
            xh.onload = function() {
                document.getElementById("respuesta").innerText = xh.responseText;

                if(xh.responseText.includes("Mascota eliminada")){
                    let row = document.getElementById("row-" + id);
                    if(row){
                        row.remove(); 
                    }
                }
            };

            xh.send(params);

        }
        // Función para eliminar una mascota por ID
        function listarMascotas() {
            let xhr = new XMLHttpRequest();
            xhr.open("GET", "../Mascotas/listar.php", true);
            xhr.onload = function() {
                 // Inserto el HTML recibido (filas de la tabla) en el cuerpo de la tabla
                document.getElementById("listarMascotas").innerHTML = xhr.responseText;
            };
            xhr.send(); //Envio solicitud al servidor
        }
    </script>
    
    
    
</html>
